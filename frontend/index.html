<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3D AI Studio</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --accent-gradient: linear-gradient(135deg, #ff6b6b, #ee5a24);
      --success-gradient: linear-gradient(135deg, #00d2ff, #3a7bd5);
      --dark-gradient: linear-gradient(135deg, #2c3e50, #34495e);
      --glass-bg: rgba(255, 255, 255, 0.95);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.15);
      --shadow-medium: 0 15px 35px rgba(31, 38, 135, 0.2);
      --shadow-heavy: 0 25px 50px rgba(0, 0, 0, 0.15);
      --border-radius: 16px;
      --border-radius-lg: 24px;
      --text-dark: #2c3e50;
      --text-medium: #6c757d;
      --text-light: #8e9aaf;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b6b 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .app-container {
      width: 100%;
      max-width: 1400px;
      height: 90vh;
      display: flex;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-heavy);
      overflow: hidden;
      position: relative;
      border: 1px solid var(--glass-border);
      animation: slideIn 0.8s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Resize Handle */
    .resize-handle {
      position: absolute;
      right: 400px;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(to bottom, transparent, var(--primary-gradient), transparent);
      cursor: col-resize;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .resize-handle:hover,
    .resize-handle.dragging {
      opacity: 1;
    }

    /* 3D Viewer Section */
    .viewer-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      position: relative;
      overflow: hidden;
    }

    .viewer-header {
      background: var(--dark-gradient);
      color: white;
      padding: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .viewer-header h1 {
      font-size: 1.6rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .viewer-header h1::before {
      content: 'üéØ';
      font-size: 1.8rem;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .info-toggle {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 10px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      backdrop-filter: blur(10px);
    }

    .info-toggle:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2);
    }

    .info-toggle.active {
      background: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .btn {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(10px);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2);
    }

    .btn.primary {
      background: var(--accent-gradient);
      border: none;
      font-weight: 600;
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, #ff5252, #e53e3e);
      box-shadow: 0 4px 20px rgba(255, 107, 107, 0.4);
    }

    .viewer-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      position: relative;
      overflow: hidden;
    }

    .viewer-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    .placeholder {
      text-align: center;
      color: var(--text-medium);
      font-size: 1.1rem;
      z-index: 1;
      position: relative;
    }

    .placeholder-icon {
      font-size: 5rem;
      margin-bottom: 1.5rem;
      opacity: 0.6;
      animation: float 3s ease-in-out infinite;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .placeholder p {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .placeholder small {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .model-info {
      position: absolute;
      top: 100px;
      left: 24px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      display: none;
      min-width: 280px;
      border: 1px solid var(--glass-border);
      z-index: 5;
    }

    .model-info.show {
      display: block;
      animation: slideInLeft 0.4s ease;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .model-info h4 {
      margin: 0 0 12px 0;
      color: var(--text-dark);
      font-size: 1.1rem;
      font-weight: 600;
    }

    .model-info p {
      margin: 0;
      color: var(--text-medium);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .model-info .close-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: var(--text-medium);
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .model-info .close-btn:hover {
      background: #f8f9fa;
      color: var(--text-dark);
      transform: scale(1.1);
    }

    /* Chat Section */
    .chat-section {
      width: 400px;
      display: flex;
      flex-direction: column;
      background: white;
      border-left: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
    }

    .chat-header {
      background: var(--primary-gradient);
      color: white;
      padding: 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .chat-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .chat-header h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 1;
    }

    .chat-header h2::before {
      content: 'üß†';
      margin-right: 8px;
      font-size: 1.6rem;
    }

    .chat-subtitle {
      font-size: 0.95rem;
      opacity: 0.9;
      font-weight: 400;
      position: relative;
      z-index: 1;
    }

    .chat-messages {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      background: linear-gradient(to bottom, #fafbfc, #f8f9fa);
      position: relative;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--primary-gradient);
      border-radius: 3px;
    }

    .message {
      max-width: 85%;
      padding: 14px 18px;
      border-radius: 18px;
      font-size: 0.95rem;
      line-height: 1.5;
      animation: messageSlide 0.4s ease-out;
      position: relative;
      font-weight: 400;
    }

    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      align-self: flex-end;
      background: var(--primary-gradient);
      color: white;
      border-bottom-right-radius: 6px;
      box-shadow: var(--shadow-light);
    }

    .message.bot {
      align-self: flex-start;
      background: white;
      border: 1px solid #e9ecef;
      border-bottom-left-radius: 6px;
      box-shadow: var(--shadow-light);
      color: var(--text-dark);
    }

    .message.system {
      align-self: center;
      background: var(--success-gradient);
      color: white;
      font-size: 0.85rem;
      padding: 10px 18px;
      border-radius: 20px;
      max-width: 90%;
      font-weight: 500;
      box-shadow: var(--shadow-light);
    }

    .typing-indicator {
      align-self: flex-start;
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 18px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-light);
      animation: messageSlide 0.4s ease-out;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-medium);
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-8px); opacity: 1; }
    }

    .chat-input-area {
      padding: 20px 24px 24px;
      background: white;
      border-top: 1px solid #e9ecef;
      position: relative;
    }

    .file-upload-area {
      margin-bottom: 12px;
      padding: 12px 16px;
      border: 2px dashed #dee2e6;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      position: relative;
      overflow: hidden;
    }

    .file-upload-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
      transition: left 0.5s ease;
    }

    .file-upload-area:hover {
      border-color: #667eea;
      background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
      transform: translateY(-1px);
    }

    .file-upload-area:hover::before {
      left: 100%;
    }

    .file-upload-area.dragover {
      border-color: #667eea;
      background: linear-gradient(135deg, #e6f3ff, #d1ecf1);
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 1.2rem;
      color: var(--text-medium);
    }

    .upload-text {
      font-size: 0.9rem;
      color: var(--text-medium);
      flex: 1;
      font-weight: 500;
    }

    .file-preview {
      display: none;
      margin-bottom: 12px;
      padding: 12px;
      background: linear-gradient(135deg, #e8f5e8, #d4edda);
      border-radius: 12px;
      border: 1px solid #c3e6c3;
      font-size: 0.85rem;
      animation: slideDown 0.3s ease;
    }

    .file-preview.show {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-input-form {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .input-wrapper {
      flex: 1;
      position: relative;
    }

    .chat-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #e9ecef;
      border-radius: 20px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
      resize: none;
      min-height: 48px;
      max-height: 120px;
      font-family: inherit;
      background: white;
    }

    .chat-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }

    .send-btn {
      background: var(--primary-gradient);
      border: none;
      color: white;
      padding: 14px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-light);
      min-width: 80px;
      justify-content: center;
    }

    .send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
    }

    .send-btn:active {
      transform: translateY(0);
    }

    .send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .file-input {
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e9ecef;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 12px;
      display: none;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .progress-bar.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary-gradient);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 3px;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
      animation: progressShimmer 2s infinite;
    }

    @keyframes progressShimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Enhanced Responsive Design */
    @media (max-width: 1024px) {
      .app-container {
        flex-direction: column;
        height: 95vh;
      }
      
      .chat-section {
        width: 100%;
        height: 50%;
        border-left: none;
        border-top: 1px solid #e9ecef;
      }
      
      .resize-handle {
        display: none;
      }

      .viewer-section {
        height: 50%;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .app-container {
        height: 100vh;
        border-radius: var(--border-radius);
      }
      
      .viewer-header, .chat-header {
        padding: 20px;
      }
      
      .viewer-header h1 {
        font-size: 1.4rem;
      }

      .chat-header h2 {
        font-size: 1.2rem;
      }
      
      .controls {
        flex-wrap: wrap;
        gap: 8px;
      }

      .btn {
        padding: 8px 12px;
        font-size: 0.85rem;
      }

      .chat-messages {
        padding: 16px;
      }

      .chat-input-area {
        padding: 16px 20px 20px;
      }

      .model-info {
        left: 16px;
        right: 16px;
        min-width: auto;
      }
    }

    @media (max-width: 480px) {
      .message {
        max-width: 95%;
        padding: 12px 16px;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .btn {
        justify-content: center;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      .chat-messages {
        background: linear-gradient(to bottom, #1a1d23, #16191e);
      }

      .message.bot {
        background: #2d3748;
        border-color: #4a5568;
        color: #e2e8f0;
      }

      .chat-input {
        background: #2d3748;
        border-color: #4a5568;
        color: #e2e8f0;
      }

      .file-upload-area {
        background: #2d3748;
        border-color: #4a5568;
      }
    }

    /* Loading animation for model viewer */
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-gradient);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Success animation */
    .success-checkmark {
      display: inline-block;
      font-size: 4rem;
      color: #28a745;
      animation: bounce 0.6s ease-in-out;
    }

    @keyframes bounce {
      0%, 20%, 60%, 100% { transform: translateY(0); }
      40% { transform: translateY(-20px); }
      80% { transform: translateY(-10px); }
    }
  </style>
</head>
<body>
  <div class="app-container" id="app-container">
    <!-- Resize Handle -->
    <div class="resize-handle" id="resize-handle"></div>
    
    <!-- 3D Viewer Section -->
    <div class="viewer-section">
      <div class="viewer-header">
        <h1>3D Model Viewer</h1>
        <div class="controls">
          <button class="info-toggle" id="info-toggle" title="Toggle Model Info">‚ÑπÔ∏è</button>
          <button class="btn" id="reset-view">üîÑ Reset View</button>
          <button class="btn" id="wireframe-toggle">üìê Wireframe</button>
          <button class="btn primary" id="download-model">üíæ Download</button>
        </div>
      </div>
      
      <div class="viewer-area" id="viewer-area">
        <div class="placeholder">
          <div class="placeholder-icon">üé≤</div>
          <p>Your 3D model will appear here</p>
          <small>Start chatting to generate your first model!</small>
        </div>
      </div>
      
      <div class="model-info" id="model-info">
        <button class="close-btn" id="close-info">√ó</button>
        <h4>Model Information</h4>
        <p id="model-details">No model loaded</p>
      </div>
    </div>

    <!-- Chat Section -->
    <div class="chat-section">
      <div class="chat-header">
        <h2>AI Assistant</h2>
        <div class="chat-subtitle">Describe your 3D model idea</div>
      </div>
      
      <div class="chat-messages" id="chat-messages">
        <div class="message bot">
          Hello! I'm your 3D modeling assistant. Describe what you'd like to create, and I'll help you generate a 3D model. You can also upload reference images or existing 3D files! ‚ú®
        </div>
      </div>
      
      <div class="chat-input-area">
        <div class="file-upload-area" id="file-upload-area">
          <div class="upload-icon">üìé</div>
          <div class="upload-text">
            Click to upload files (Images, 3D models)
          </div>
          <input type="file" class="file-input" id="file-input" accept=".png,.jpg,.jpeg,.obj,.stl,.glb,.gltf" multiple>
        </div>
        
        <div class="file-preview" id="file-preview"></div>
        
        <div class="progress-bar" id="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        
        <form class="chat-input-form" id="chat-form">
          <div class="input-wrapper">
            <textarea 
              class="chat-input" 
              id="chat-input" 
              placeholder="Describe your 3D model (e.g., 'a medieval castle with towers')"
              rows="1"
            ></textarea>
          </div>
          <button type="submit" class="send-btn" id="send-btn">
            <span>Send</span> ‚úàÔ∏è
          </button>
        </form>
      </div>
    </div>
  </div>

  <script>
    class TextTo3DApp {
      constructor() {
        this.currentFiles = [];
        this.isGenerating = false;
        this.isResizing = false;
        this.modelInfoVisible = false;
        this.initializeElements();
        this.setupEventListeners();
        this.setupDragAndDrop();
        this.autoResizeTextarea();
        this.setupResize();
      }

      initializeElements() {
        this.chatMessages = document.getElementById('chat-messages');
        this.chatForm = document.getElementById('chat-form');
        this.chatInput = document.getElementById('chat-input');
        this.sendBtn = document.getElementById('send-btn');
        this.fileInput = document.getElementById('file-input');
        this.fileUploadArea = document.getElementById('file-upload-area');
        this.filePreview = document.getElementById('file-preview');
        this.progressBar = document.getElementById('progress-bar');
        this.progressFill = document.getElementById('progress-fill');
        this.viewerArea = document.getElementById('viewer-area');
        this.modelInfo = document.getElementById('model-info');
        this.downloadBtn = document.getElementById('download-model');
        this.resizeHandle = document.getElementById('resize-handle');
        this.appContainer = document.getElementById('app-container');
        this.chatSection = document.querySelector('.chat-section');
        this.infoToggle = document.getElementById('info-toggle');
        this.closeInfo = document.getElementById('close-info');
      }

      setupEventListeners() {
        this.chatForm.addEventListener('submit', (e) => this.handleSubmit(e));
        this.fileUploadArea.addEventListener('click', () => this.fileInput.click());
        this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
        this.downloadBtn.addEventListener('click', () => this.downloadModel());
        this.infoToggle.addEventListener('click', () => this.toggleModelInfo());
        this.closeInfo.addEventListener('click', () => this.hideModelInfo());
        
        document.getElementById('reset-view').addEventListener('click', () => this.resetView());
        document.getElementById('wireframe-toggle').addEventListener('click', () => this.toggleWireframe());
      }

      setupDragAndDrop() {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          this.fileUploadArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
          });
        });

        ['dragenter', 'dragover'].forEach(eventName => {
          this.fileUploadArea.addEventListener(eventName, () => {
            this.fileUploadArea.classList.add('dragover');
          });
        });

        ['dragleave', 'drop'].forEach(eventName => {
          this.fileUploadArea.addEventListener(eventName, () => {
            this.fileUploadArea.classList.remove('dragover');
          });
        });

        this.fileUploadArea.addEventListener('drop', (e) => {
          const files = e.dataTransfer.files;
          this.handleFiles(files);
        });
      }

      setupResize() {
        this.resizeHandle.addEventListener('mousedown', (e) => {
          this.isResizing = true;
          this.resizeHandle.classList.add('dragging');
          document.addEventListener('mousemove', this.handleResize.bind(this));
          document.addEventListener('mouseup', this.stopResize.bind(this));
          e.preventDefault();
        });
      }

      handleResize(e) {
        if (!this.isResizing) return;
        
        const containerRect = this.appContainer.getBoundingClientRect();
        const newChatWidth = containerRect.right - e.clientX;
        const minChatWidth = 350;
        const maxChatWidth = 800;
        const minViewerWidth = 400;
        
        if (newChatWidth >= minChatWidth && newChatWidth <= maxChatWidth && 
            (containerRect.width - newChatWidth) >= minViewerWidth) {
          this.chatSection.style.width = newChatWidth + 'px';
          this.resizeHandle.style.right = newChatWidth + 'px';
        }
      }

      stopResize() {
        this.isResizing = false;
        this.resizeHandle.classList.remove('dragging');
        document.removeEventListener('mousemove', this.handleResize);
        document.removeEventListener('mouseup', this.stopResize);
      }

      toggleModelInfo() {
        if (this.modelInfoVisible) {
          this.hideModelInfo();
        } else {
          this.showModelInfo();
        }
      }

      showModelInfo() {
        this.modelInfo.classList.add('show');
        this.infoToggle.classList.add('active');
        this.modelInfoVisible = true;
      }

      hideModelInfo() {
        this.modelInfo.classList.remove('show');
        this.infoToggle.classList.remove('active');
        this.modelInfoVisible = false;
      }

      handleFileSelect(e) {
        this.handleFiles(e.target.files);
      }

      autoResizeTextarea() {
        this.chatInput.addEventListener('input', () => {
          this.chatInput.style.height = 'auto';
          this.chatInput.style.height = Math.min(this.chatInput.scrollHeight, 120) + 'px';
        });
      }

      handleFiles(files) {
        this.currentFiles = Array.from(files);
        this.displayFilePreview();
      }

      clearFiles() {
        this.currentFiles = [];
        this.fileInput.value = '';
        this.filePreview.classList.remove('show');
      }

      formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      addMessage(text, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.textContent = text;
        
        this.chatMessages.appendChild(messageDiv);
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
      }

      async handleSubmit(e) {
        e.preventDefault();
        
        const message = this.chatInput.value.trim();
        if (!message && this.currentFiles.length === 0) return;

        if (this.isGenerating) return;

        // Add user message
        if (message) {
          this.addMessage(message, 'user');
          this.chatInput.value = '';
          this.chatInput.style.height = 'auto';
        }

        // Show file upload info
        if (this.currentFiles.length > 0) {
          this.addMessage(`üìé Uploaded ${this.currentFiles.length} file(s): ${this.currentFiles.map(f => f.name).join(', ')}`, 'system');
        }

        this.isGenerating = true;
        this.sendBtn.disabled = true;
        this.showTypingIndicator();
        this.showProgress();

        try {
          // Simulate API call - replace with actual backend call
          await this.callAPI(message, this.currentFiles);
        } catch (error) {
          this.addMessage('Sorry, there was an error processing your request. Please try again.', 'bot');
        } finally {
          this.isGenerating = false;
          this.sendBtn.disabled = false;
          this.hideTypingIndicator();
          this.hideProgress();
          this.clearFiles();
        }
      }

      async callAPI(message, files) {
        // Replace this with your actual API endpoint
        const formData = new FormData();
        formData.append('message', message);
        
        files.forEach((file, index) => {
          formData.append(`file_${index}`, file);
        });

        try {
          // Simulate progress
          let progress = 0;
          const progressInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 90) progress = 90;
            this.updateProgress(progress);
          }, 200);

          // Replace with actual fetch to your backend
          const response = await fetch('http://localhost:5000/generate-3d', {
            method: 'POST',
            body: formData
          });

          clearInterval(progressInterval);
          this.updateProgress(100);

          if (!response.ok) {
            throw new Error('API request failed');
          }

          const data = await response.json();
          
          // Handle the response
          this.addMessage(data.message || 'Model generated successfully!', 'bot');
          
          if (data.model_url) {
            this.load3DModel(data.model_url);
          }

        } catch (error) {
          // Simulate response for demo
          await new Promise(resolve => setTimeout(resolve, 2000));
          this.updateProgress(100);
          
          if (message.toLowerCase().includes('castle')) {
            this.addMessage("Great idea! I've generated a medieval castle with stone towers and battlements. The model includes detailed texturing and is ready for download. You can rotate the view to see all angles!", 'bot');
            this.simulateModelLoad('Medieval Castle');
          } else if (message.toLowerCase().includes('car')) {
            this.addMessage("I've created a sleek car model based on your description. The model features realistic proportions and clean geometry. Perfect for games or visualization!", 'bot');
            this.simulateModelLoad('Car Model');
          } else if (message.toLowerCase().includes('house')) {
            this.addMessage("Perfect! I've designed a beautiful house model with modern architecture. The model includes windows, doors, and a detailed roof structure.", 'bot');
            this.simulateModelLoad('Modern House');
          } else if (message.toLowerCase().includes('dragon')) {
            this.addMessage("Wow! I've created an epic dragon model with detailed scales, wings, and a fierce expression. This mythical creature is ready to soar!", 'bot');
            this.simulateModelLoad('Dragon Model');
          } else {
            this.addMessage(`I've processed your request for "${message}" and generated a 3D model. The model is now ready for viewing and download!`, 'bot');
            this.simulateModelLoad('3D Model');
          }
        }
      }

      displayFilePreview() {
        if (this.currentFiles.length === 0) {
          this.filePreview.classList.remove('show');
          return;
        }

        this.filePreview.classList.add('show');
        this.filePreview.innerHTML = `
          <strong>üìÅ Selected files:</strong><br>
          ${this.currentFiles.map(file => `üìÑ ${file.name} (${this.formatFileSize(file.size)})`).join('<br>')}
          <button type="button" onclick="app.clearFiles()" style="margin-left: 10px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; border: none; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease;">‚úï Clear</button>
        `;
      }

      simulateModelLoad(modelName) {
        // Show loading first
        this.viewerArea.innerHTML = `
          <div style="text-align: center; color: var(--text-medium); font-size: 1.1rem;">
            <div class="loading-spinner"></div>
            <p style="font-weight: 500;">Generating ${modelName}...</p>
            <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">Please wait while we create your model</p>
          </div>
        `;

        // After 2 seconds, show success
        setTimeout(() => {
          this.viewerArea.innerHTML = `
            <div style="text-align: center; color: #28a745; font-size: 1.2rem;">
              <div class="success-checkmark">‚úÖ</div>
              <p style="font-weight: 600; margin-bottom: 0.5rem;">${modelName}</p>
              <p style="font-size: 0.9rem; color: var(--text-medium); margin-top: 0.5rem;">Model loaded successfully</p>
              <div style="margin-top: 1rem; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button onclick="app.resetView()" style="background: var(--primary-gradient); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">üîÑ Reset View</button>
                <button onclick="app.toggleWireframe()" style="background: var(--success-gradient); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; font-weight: 500;">üìê Wireframe</button>
              </div>
            </div>
          `;
        }, 2000);
        
        // Update model info
        document.getElementById('model-details').innerHTML = `
          <strong>üìä ${modelName}</strong><br><br>
          <strong>Vertices:</strong> ${Math.floor(Math.random() * 5000) + 1000}<br>
          <strong>Faces:</strong> ${Math.floor(Math.random() * 8000) + 2000}<br>
          <strong>File Size:</strong> ${(Math.random() * 5 + 1).toFixed(1)} MB<br>
          <strong>Format:</strong> GLB<br>
          <strong>Quality:</strong> High Definition<br><br>
          <small style="color: var(--text-light);">Ready for download and use in your projects!</small>
        `;
      }

      load3DModel(modelUrl) {
        // Implement actual 3D model loading here
        // You can use Three.js or other 3D libraries
        console.log('Loading 3D model from:', modelUrl);
      }

      showTypingIndicator() {
        const typingDiv = document.createElement('div');
        typingDiv.className = 'typing-indicator';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
          <span style="font-weight: 500;">AI is thinking</span>
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        `;
        
        this.chatMessages.appendChild(typingDiv);
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
      }

      hideTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      showProgress() {
        this.progressBar.classList.add('show');
        this.updateProgress(0);
      }

      hideProgress() {
        setTimeout(() => {
          this.progressBar.classList.remove('show');
        }, 500);
      }

      updateProgress(percentage) {
        this.progressFill.style.width = percentage + '%';
      }

      downloadModel() {
        // Implement model download functionality
        this.addMessage('üéâ Download started! Your 3D model will be saved to your downloads folder.', 'system');
        
        // Simulate download progress
        this.showProgress();
        let progress = 0;
        const downloadInterval = setInterval(() => {
          progress += Math.random() * 20;
          if (progress >= 100) {
            progress = 100;
            clearInterval(downloadInterval);
            this.hideProgress();
            this.addMessage('‚úÖ Download complete! Your model is ready to use.', 'system');
          }
          this.updateProgress(progress);
        }, 150);
      }

      resetView() {
        // Implement view reset
        this.addMessage('üîÑ 3D view has been reset to default position.', 'system');
        console.log('Reset 3D view');
      }

      toggleWireframe() {
        // Implement wireframe toggle
        this.addMessage('üìê Wireframe mode toggled.', 'system');
        console.log('Toggle wireframe mode');
      }
    }

    // Initialize the app
    const app = new TextTo3DApp();

    // Add some welcome interactions
    setTimeout(() => {
      app.addMessage("üí° Pro tip: Try describing objects like 'futuristic spaceship', 'cozy wooden cabin', or 'fantasy sword' for best results!", 'bot');
    }, 2000);
  </script>
</body>
</html>